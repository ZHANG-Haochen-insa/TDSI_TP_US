# TP 超声断层扫描

本TP的目标是解释断层扫描中图像形成的基本原理。将使用超声波进行说明。

断层扫描在X射线成像（X-ray CT，即计算机断层扫描）中非常常用。它包括从为不同视角采集的一组投影重建物体衰减的图像。其原理如图1左侧所示。每次采集称为“线”，并提供一个“沿波路径积分”的量。

在本TP中，断层扫描是使用超声波实现的。X射线断层扫描和超声断层扫描之间的唯一区别在于重建的物理量。在X射线断层扫描中，估计的是X射线的衰减，而在超声断层扫描中，估计的是物体中声波的衰减。可以使用相同的重建算法。

在传统的X射线断层扫描中，我们使用一个线性探测器（N个像素）。在这里，我们使用一个将进行平移的**点状探测器**。其原理如图1右侧所示。为了实现物体的断层扫描，对于给定的角度，必须采集N个投影的集合（该集合在下文中称为A-scan矩阵，并在图1中由1个扫描表示）。这些投影是在平行几何结构中采集的。这些信号的采集将在第1部分中完成。

**X射线CT**
**US-CT**

换能器
换能器

扫描 1：
物体
接收器

扫描 2：
物体

扫描 3：
物体
物体
接收器
物体
物体

**图 1**：（左）经典X射线断层扫描原理，（右）本TP中实现的US断层扫描原理。

---

在第2部分中，我们将根据传感器的输出来计算重建算法的输入量。我们将其与GS-EchoView软件给出的值进行比较。

然后，我们将执行R次旋转的集合，以记录断层扫描所需的所有信号。断层扫描将由GS-EchoView软件完成（第3部分）。

在第4部分中，您将需要自己通过逆Radon变换来实现断层扫描。

**TP的组织：**

1.  A-Scan矩阵的记录
2.  该矩阵的幅度计算
3.  使用GS-EchoView完成所有旋转和断层扫描
4.  在Matlab中实现断层扫描

**图 2**：实验装置

---

## 第1部分：A-scan矩阵的设置和采集

A-scan是指采集N个信号的集合，对应于N条平行线（由图1右侧的1个扫描表示）。为了采集它们，需要对物体进行N次平移，并且信号存储在A-scan矩阵中。

**问题1：**请说明选择物体平移来实现A-scan的理由。

**硬件设置**

*   给水箱加水。
*   清洁水箱两侧两个换能器的位置，以清除任何可能干扰测量的物质残留。
*   在两个2MHz单换能器的中心涂抹少量Transound凝胶，并将它们安装在水箱上为它们准备的位置（拧紧以固定）。前后移动探头以均匀分布凝胶。

**问题2：**凝胶有什么用？如果凝胶分布不均，可能会出现什么问题？

**参数设置**

**硬件部分**

*   打开“Echoscope GS200-Gampt”和“Computer Tomograph UCT200-Gampt”。
*   将选择器置于透射模式（1/2），并将每个探头连接到一个端口（探头1，探头2）。“探头1”将是发射器，“探头2”将是接收器。将所有TGC滑块设置为0。

**软件部分**

*   启动GS-EchoView软件。
*   要开始采集，请选择“Start A-scan”。记录的信号出现在左上方的框中。

**问题3：**如果水箱宽度为14厘米（水中声波传播速度=1500 m/s），计算发射信号（=被接收器接收）的理论到达时间。

*   调整时间窗口，以便能够看到该信号（“Params”选项卡），总记录时长为60微秒。
*   调整发射增益（Gain dB）和接收增益（Output dB），以使信号不饱和。

**采集**

*   将样本放置在机器人工作台（黑色圆柱体）上。样本通过顶部（磁吸）固定。通过降低水平杆（已拧紧）将样本浸入水中。
*   将样本放置在单换能器的中心（水平和垂直）。对于水平位置，使用“Scanner”选项卡，可以在不启动CT的情况下控制位置平台。

---

*   在右上角选择CT模式并显示CT-mode选项卡。取消选中“Use external trigger”并选中“Line break”以允许进行单次平移。
*   设置采集长度L以扫描整个物体。将位移步长设置为5毫米。

**问题4：**计算为创建A-scan矩阵将要执行的N次采集的数量，已知样本直径为60毫米。

*   **注意**：在开始断层扫描之前，物体必须位于中心，系统负责将物体移动L/2。
*   选中“Both”（在A-scan selection中）和“Shot break”以允许在平移过程中单独记录每个A-scan。单击“Start CT”。第一次采集完成。
*   要记录信号，请将鼠标放在显示的A-scan信号上。单击“Enregistrer”（记录）图标。选择“Save Data”并命名文件（pos_1，记得创建一个独立的目录）。
*   要继续平移，请单击“Continue Shot”。将进行新的采集。
*   以相同的方式进行记录。重复此操作以记录A-scan矩阵的N个信号。
*   **注意**：一旦记录了N个信号，右侧的面板（断层扫描）就会显示出来。
*   Gampt系统会为每次采集计算幅度和到达时间，并将其显示在左下方的面板中。记录这些值，以便稍后与您自己估计的值进行比较。为此，请将鼠标放在“Attenuation / Sound velocity”面板上，然后单击“enregistrer”（记录）（文件A_scan_test.dat）。记录方式与之前相同（两个曲线存储在同一文件中，之后我们只使用幅度，因为到达时间在我们的情况下不够精确）。
*   记录完成后，通过单击“Cancel CT”停止系统。A-scan矩阵以及系统计算的幅度和时间都已记录。

---

## 第2部分：读取A-scan矩阵并提取断层扫描的可观察量

*   启动Matlab。将文件`lecture_donnees_etu.m`复制到您的目录中，完成并运行它。该程序读取A-scan期间记录的所有信号，并将其保存在`matrice_A_scan_test.mat`中。
*   观察并理解创建的不同变量。

**问题5：**显示A-scan矩阵及其包络（以dB表示包络）。

为了进行断层扫描，我们引入了Radon变换：

R[f](u, θ) = ∫ L(u,θ) f(x,y) dl

该变换是可逆的，逆Radon变换通常用于对断层扫描中的物体进行成像。

---

此外，我们知道声波在传播过程中的衰减可以写成：

A = A₀ exp(-∫ L μ(x,y) dl)

**问题6a：**提出了一个可以从A-scan中的原始时间信号中表示衰减项 ∫μ(x, y)dl 的量。

**问题6b：**从采集的数据中提取该量，并与GS-EchoView软件提取的值（变量`amp_extraites`）进行比较。

---

## 第3部分：使用GS-EchoView记录幅度和进行断层扫描

在这一部分中，您将记录所有必要的信号以及断层扫描本身，使用GS-EchoView软件中实现的算法。

*   此外，为了自己实现断层扫描，您将需要记录GS-EchoView为每次旋转计算的幅度。为此，请取消选中“Shot break”。
*   现在必须设置将决定旋转次数的角度步长。选择一个等于16.2°的角度步长。

**问题7：**物体完成一次完整旋转，计算将执行的R次旋转的次数。

*   此处有意限制旋转次数，以免增加需要手动执行的记录数量。

**问题8：**使用更多的角度会有什么效果？

*   此外，为了获得满意的结果，请将平移步长设置为2毫米。

**问题9：**计算断层扫描的总测量次数。

*   单击“Start CT”开始采集。第一次平移开始。完成后，您可以像第1部分中那样记录幅度。
*   通过单击“Continue CT”开始下一次角度的采集。以相同的方式记录幅度（在A_scan_numero.dat中）。
*   对所有角度重复此操作。断层扫描的中间结果显示在“Amplitude unfiltered”面板中。
*   一旦所有采集完成，最终的断层扫描结果可以获得物体中声波衰减的图。

**问题10：**评论所获得的结果。

*   保存最终的断层扫描图像，以便稍后与您的结果进行比较。

**问题11：**如何获得更好的断层扫描结果？

---

## 第4部分：在Matlab下进行断层扫描

*   将文件`lecture_tomo_etu.m`复制到您的目录中，完成并运行它。该程序读取所有提取的可观察量，并将其记录在`Matrice_acqui_angle.mat`中。
*   观察并理解创建的不同变量。

**问题12：**显示可观察量的矩阵。

**问题13：**使用Matlab中可用的`iradon`函数，实现断层扫描。我们将实现无滤波的经典断层扫描以及使用Shepp-Logan滤波器和样条插值的滤波反投影。

*   将结果与GS-EchoView软件获得的结果进行比较。

**如果您到此为止，说明您已经理解了断层扫描的主要原理。**
